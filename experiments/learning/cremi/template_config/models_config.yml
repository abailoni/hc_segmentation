threshold_090:
  model_ID: 1
  volumes:
    init_segmentation:
      # The '$' character will be replaced with the sample name:
      path: '/export/home/abailoni/learnedHC/plain_unstruct/MWSoffs_bound2_pyT4/postprocess/inferName_v1_DTWS_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'
    GT:
      path_in_h5_dataset: 'finalSegm_bestGT'
  threshold: 0.9
  # Three options available: 'None', 'only_merge_mistakes', 'all_mistakes'
  trained_mistakes: 'none'

threshold_090_struct:
  model_ID: 2
  volumes:
    init_segmentation:
      # The '$' character will be replaced with the sample name:
      path: '/export/home/abailoni/learnedHC/plain_unstruct/MWSoffs_bound2_pyT4/postprocess/inferName_v1_DTWS_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'
    GT:
      path_in_h5_dataset: 'finalSegm_bestGT'
  threshold: 0.9
  # Three options available: 'None', 'only_merge_mistakes', 'all_mistakes'
  trained_mistakes: 'only_merge_mistakes'

plain_affs:
  model_ID: 3
  volumes: {}
  postproc:
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.98

  # 'only_merge_mistakes', 'all_mistakes', 'only_split_mistakes'
  train:
    HC_config:
      loss_BCE_factor: 0.
      erode_boundary_thickness: 2
      struct_weights_kwargs:
        trained_mistakes: 'none'
        weighting_merge_mistakes: 1.0
        weighting_split_mistakes: 1.0
        train_correct_predictions: False
    pretrained_model_kwargs:
      in_channels: 1

plain_affs_biggerModel:
  model_ID: 20
  volumes: {}
  postproc:
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.98

  # 'only_merge_mistakes', 'all_mistakes', 'only_split_mistakes'
  train:
    HC_config:
      loss_BCE_factor: 0.
      erode_boundary_thickness: 2
      struct_weights_kwargs:
        trained_mistakes: 'none'
        weighting_merge_mistakes: 1.0
        weighting_split_mistakes: 1.0
        train_correct_predictions: False
    pretrained_model_kwargs:
      in_channels: 1
      initial_num_fmaps: 54
  data:
    slicing_config:
      data_slice:
        A: ':, :, :'
        B: ':, :, :'
        C: ':, :, :'


#
#superpixels_struct:
#  model_ID: 4
#  volumes: {}
#  threshold: 0.9
#  # Three options available: 'None', 'only_merge_mistakes', 'all_mistakes'
#  trained_mistakes: 'only_merge_mistakes'


threshold_050:
  model_ID: 5
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/model_090/pureDICE/postprocess/inferName_v1_1_HC_090_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'
    GT:
      path_in_h5_dataset: 'finalSegm_bestGT'
  threshold: 0.5
  # Three options available: 'None', 'only_merge_mistakes', 'all_mistakes'
  trained_mistakes: 'none'

threshold_050_struct:
  model_ID: 6
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/model_090/pureDICE/postprocess/inferName_v1_1_HC_090_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'
    GT:
      path_in_h5_dataset: 'finalSegm_bestGT'

  postproc:
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.5

  # 'only_merge_mistakes', 'all_mistakes', 'only_split_mistakes'
  train:
    HC_config:
      loss_BCE_factor: 0.1
      erode_boundary_thickness: 0
      struct_weights_kwargs:
        trained_mistakes: 'all_mistakes'
        weighting_merge_mistakes: 1.0
        weighting_split_mistakes: 1.0
        train_correct_predictions: False
    pretrained_model_kwargs:
      in_channels: 16

threshold_090_newOversegm:
  model_ID: 7
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/plain_unstruct/MWSoffs_bound2_pyT4/postprocess/inferName_v1_01_HC098_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm_WS'
    GT:
      path_in_h5_dataset: 'finalSegm_bestGT'

  postproc:
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.9

  # 'only_merge_mistakes', 'all_mistakes', 'only_split_mistakes'
  train:
    HC_config:
      loss_BCE_factor: 0.
      erode_boundary_thickness: 0
      struct_weights_kwargs:
        trained_mistakes: 'none'
        weighting_merge_mistakes: 1.0
        weighting_split_mistakes: 1.0
        train_correct_predictions: False
    pretrained_model_kwargs:
      in_channels: 16

  data:
    slicing_config:
      data_slice:
        A: ':, :, :'
        B: ':, :, :'
        C: ':, :, :'


threshold_050_B_newOversegm:
  model_ID: 8
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/model_090_v2/unstrInitSegm_pureDICE/postprocess/inferName_v1_HC_050_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'
    GT:
      path_in_h5_dataset: 'finalSegm_bestGT'

  postproc:
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.5

  # 'only_merge_mistakes', 'all_mistakes', 'only_split_mistakes'
  train:
    HC_config:
      loss_BCE_factor: 0.
      erode_boundary_thickness: 0
      struct_weights_kwargs:
        trained_mistakes: 'none'
        weighting_merge_mistakes: 1.0
        weighting_split_mistakes: 1.0
        train_correct_predictions: False
    pretrained_model_kwargs:
      in_channels: 16

threshold_050_A_newOversegm:
  model_ID: 9
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/model_090_v2/unstrInitSegm_pureDICE/postprocess/inferName_v1_HC_090_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm_WS'
    GT:
      path_in_h5_dataset: 'finalSegm_WS_bestGT'

  postproc:
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.5

  # 'only_merge_mistakes', 'all_mistakes', 'only_split_mistakes'
  train:
    HC_config:
      loss_BCE_factor: 0.
      erode_boundary_thickness: 0
      struct_weights_kwargs:
        trained_mistakes: 'none'
        weighting_merge_mistakes: 1.0
        weighting_split_mistakes: 1.0
        train_correct_predictions: False
    pretrained_model_kwargs:
      in_channels: 16

  data:
      slicing_config:
        data_slice:
          A: ':, :, :'
          B: ':, :, :'
          C: ':, :, :'


combined_model_wholeDataSet:
  model_ID: 100
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/plain_unstruct/MWSoffs_bound2_pyT4/postprocess/inferName_v1_01_HC098_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm_WS'
    GT:
      path: '/export/home/abailoni/learnedHC/plain_unstruct/MWSoffs_bound2_pyT4/postprocess/inferName_v1_01_HC098_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm_bestGT'
    segmFinal:
      path: '/export/home/abailoni/learnedHC/model_090_v2/unstrInitSegm_pureDICE/postprocess/inferName_v1_HC_090_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'
    underSegm:
      path: '/export/home/abailoni/learnedHC/model_050_A_v2/pureDICE/postprocess/inferName_v40k_HC_050_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'

  postproc:
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.5

  train:
    HC_config:
      loss_BCE_factor: 0.0
      erode_boundary_thickness: 2
      struct_weights_kwargs:
        trained_mistakes: 'none'
        weighting_merge_mistakes: 1.0
        weighting_split_mistakes: 0.1
        train_correct_predictions: False
    pretrained_model_kwargs:
      in_channels: 33
      initial_num_fmaps: 40

  data:
    slicing_config:
      data_slice:
        A: ':, :, :'
        B: ':, :, :'
        C: ':, :, :'
#    slicing_config:
#      window_size:
#        A: [25, 424, 424]
#        B: [25, 424, 424]
#        C: [25, 424, 424]
    master_config:
      dim_embedding_vector_space: 8
  valid:
#    slicing_config:
#      window_size:
#        A: [25, 424, 424]
#        B: [25, 424, 424]
#        C: [25, 424, 424]
    master_config:
      dim_embedding_vector_space: 8


combined_model_wholeDataSet:
  model_ID: 101
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/plain_unstruct/pureDICE_wholeTrainingSet/postprocess/inferName_v40k_HC098_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'
#    GT:
#      path: '/export/home/abailoni/learnedHC/plain_unstruct/MWSoffs_bound2_pyT4/postprocess/inferName_v1_01_HC098_$/pred_segm.h5'
#      path_in_h5_dataset: 'finalSegm_bestGT'
    segmFinal:
      path: '/export/home/abailoni/learnedHC/plain_unstruct/pureDICE_wholeTrainingSet/postprocess/inferName_v40k_HC075_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'
    underSegm:
      path: '/export/home/abailoni/learnedHC/plain_unstruct/pureDICE_wholeTrainingSet/postprocess/inferName_v40k_HC050_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'

  postproc:
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.5

  train:
    HC_config:
      loss_BCE_factor: 0.0
      erode_boundary_thickness: 2
      struct_weights_kwargs:
        trained_mistakes: 'none'
        weighting_merge_mistakes: 1.0
        weighting_split_mistakes: 0.1
        train_correct_predictions: False
    pretrained_model_kwargs:
      in_channels: 33
      initial_num_fmaps: 40

  data:
    slicing_config:
      data_slice:
        A: ':, :, :'
        B: ':, :, :'
        C: ':, :, :'
#    slicing_config:
#      window_size:
#        A: [25, 424, 424]
#        B: [25, 424, 424]
#        C: [25, 424, 424]
    master_config:
      dim_embedding_vector_space: 8
  valid:
#    slicing_config:
#      window_size:
#        A: [25, 424, 424]
#        B: [25, 424, 424]
#        C: [25, 424, 424]
    master_config:
      dim_embedding_vector_space: 8


###################################

gen_HC:
  postproc:
    segm_pipeline_type: 'gen_HC'

gen_HC_pix:
  parent_model: ['gen_HC', 'blockwise']
  postproc:
    start_from_given_segm: False
    use_fragmenter: False
    volumes:
      affinities:
        slicing_config:
          stride:
            A: [12, 1, 600, 600]
            B: [12, 1, 600, 600]
            C: [12, 1, 600, 600]
          window_size:
            A: [None, 3, 600, 600]
            B: [None, 3, 600, 600]
            C: [None, 3, 600, 600]

gen_HC_DTWS:
  parent_model: ['gen_HC']
  postproc:
    start_from_given_segm: False
    use_fragmenter: True

gen_HC_givenSP:
  parent_model: ['gen_HC']
  postproc:
    start_from_given_segm: True
    use_fragmenter: False



MWS:
  postproc:
    segm_pipeline_type: 'MWS'


MWS_from_SP:
  postproc:
    segm_pipeline_type: 'gen_HC'
    generalized_HC_kwargs:
      agglomeration_kwargs:
#        zero_init: True
        update_rule_merge: 'max'
        update_rule_not_merge: 'max'

stride10:
  parent_model: 'MWS'
  postproc:
    MWS_kwargs:
#      bias: 0. # 1.0 merge everything, 0.0 split everything (or all that is possible)
      stride:
        - 1
        - 10
        - 10
stride8:
  parent_model: 'MWS'
  postproc:
    MWS_kwargs:
      stride:
        - 1
        - 8
        - 8



multicut:
  postproc:
    segm_pipeline_type: 'multicut'

multicut_exact:
  parent_model: ['multicut']
  postproc:
    multicut_kwargs:
      solver_type: 'multicutIlpCplex'
#      beta: 0.9 # 1.0 split everything, 0.0 merge everything

multicut_givenSP:
  parent_model: ['multicut', 'given_SP']

given_SP:
  postproc:
    start_from_given_segm: True
    use_fragmenter: False

blockwise:
  postproc:
    blockwise: True
    blockwise_kwargs:
      crop_padding: True
      nb_parallel_blocks: 24
      num_workers: 1


crop_train:
  postproc:
    data_slice:
      A: ':, :, 100:-100, 100:-100'
      B: ':, :, 100:1330, 665:1750'
      C: ':, :, 150:-150, 150:-150'


DTWSplusHC090:
  parent_model: ['given_SP']
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/plain_unstruct/pureDICE_wholeTrainingSet/postprocess/inferName_v100k_DTWSplusHC090_notCropped_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'

newHC098-HC090:
  parent_model: ['given_SP']
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/model_090_v2/pureDICE_wholeDtSet/postprocess/inferName_v70k-HC098new_HC090_notCropped_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'
newHC098-HC080:
  parent_model: ['given_SP']
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/model_090_v2/pureDICE_wholeDtSet/postprocess/inferName_v70k-HC098new_HC080_notCropped_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'
newHC098-HC070:
  parent_model: ['given_SP']
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/model_090_v2/pureDICE_wholeDtSet/postprocess/inferName_v70k-HC098new_HC070_notCropped_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'

newHC098-HC070unstruct:
  parent_model: ['given_SP']
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/plain_unstruct/pureDICE_wholeTrainingSet/postprocess/inferName_v100k_newHC098-HC070-notCropped_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'

newHC098-HC080unstruct:
  parent_model: ['given_SP']
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/plain_unstruct/pureDICE_wholeTrainingSet/postprocess/inferName_v100k_newHC098-HC080-notCropped_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'

newHC098-HC090unstruct:
  parent_model: ['given_SP']
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/plain_unstruct/pureDICE_wholeTrainingSet/postprocess/inferName_v100k_newHC098-HC090-notCropped_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm'


HC098v100k:
  parent_model: ['given_SP']
  volumes:
    init_segmentation:
      path: '/export/home/abailoni/learnedHC/plain_unstruct/pureDICE_wholeTrainingSet/postprocess/inferName_v100k_HC098_notCropped_$/pred_segm.h5'
      path_in_h5_dataset: 'finalSegm_WS_inters_WS'


smallInfer:
  infer:
    slicing_config:
      window_size:
        A: [18, 540, 540]
        B: [18, 540, 540]
        C: [18, 540, 540]
      stride:
        A: [8, 360, 360]
        B: [8, 360, 360]
        C: [8, 360, 360]





thresh030:
  postproc:
    MWS_kwargs:
      bias: 0.30
    multicut_kwargs:
      beta: 0.30
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.3
thresh035:
  postproc:
    MWS_kwargs:
      bias: 0.35
    multicut_kwargs:
      beta: 0.35
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.35
thresh040:
  postproc:
    MWS_kwargs:
      bias: 0.40
    multicut_kwargs:
      beta: 0.40
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.4
thresh045:
  postproc:
    MWS_kwargs:
      bias: 0.45
    multicut_kwargs:
      beta: 0.45
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.45
thresh050:
  postproc:
    MWS_kwargs:
      bias: 0.50
    multicut_kwargs:
      beta: 0.50
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.5
thresh055:
  postproc:
    MWS_kwargs:
      bias: 0.55
    multicut_kwargs:
      beta: 0.55
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.55
thresh060:
  postproc:
    MWS_kwargs:
      bias: 0.60
    multicut_kwargs:
      beta: 0.60
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.6
thresh065:
  postproc:
    MWS_kwargs:
      bias: 0.65
    multicut_kwargs:
      beta: 0.65
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.65
thresh070:
  postproc:
    MWS_kwargs:
      bias: 0.70
    multicut_kwargs:
      beta: 0.70
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.7
thresh075:
  postproc:
    MWS_kwargs:
      bias: 0.75
    multicut_kwargs:
      beta: 0.75
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.75
thresh080:
  postproc:
    MWS_kwargs:
      bias: 0.80
    multicut_kwargs:
      beta: 0.80
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.8
thresh085:
  postproc:
    MWS_kwargs:
      bias: 0.85
    multicut_kwargs:
      beta: 0.85
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.85
thresh090:
  postproc:
    MWS_kwargs:
      bias: 0.90
    multicut_kwargs:
      beta: 0.90
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.9
thresh098:
  postproc:
    MWS_kwargs:
      bias: 0.98
    multicut_kwargs:
      beta: 0.98
    generalized_HC_kwargs:
      agglomeration_kwargs:
        extra_aggl_kwargs:
          threshold: 0.98